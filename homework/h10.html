<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-12-07 Mon 19:10 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Computer Science 3MI3 – 2020 homework 10</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Mark Armstrong" />
<meta name="description" content="Making use of concurrency approaches in all of our languages."
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/readtheorg.css"/>
<script type="text/javascript" src="styles/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="styles/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="styles/readtheorg/js/readtheorg.js"></script>
<style>pre.src{background:#000000;color:white;} </style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Computer Science 3MI3 – 2020 homework 10
<br />
<span class="subtitle">Using concurrency to break up large problems</span>
</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Boilerplate">Boilerplate</a>
<ul>
<li><a href="#Submission-procedures">Submission procedures</a>
<ul>
<li><a href="#org770b696">Submission method</a></li>
<li><a href="#org6e0a4aa">Naming requirements</a></li>
<li><a href="#org09bfc1f">Do not submit testing or diagnostic code</a></li>
<li><a href="#org6b1cca9">Due date and allowance for technical difficulties</a></li>
</ul>
</li>
<li><a href="#Proper-conduct-for-coursework">Proper conduct for coursework</a>
<ul>
<li><a href="#org152bfaa">Individual work</a></li>
<li><a href="#org300fbde">Language library resources</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Part-0:-The-problem">Part 0: The problem</a></li>
<li><a href="#Part-1:-Clojure-[15 points]">Part 1: Clojure [15 points]</a></li>
<li><a href="#Part-2:-Ruby----[15 points]">Part 2: Ruby    [15 points]</a></li>
<li><a href="#Part-3:-Scala---[15 points]">Part 3: Scala   [15 points]</a></li>
<li><a href="#Part-4:-Prolog--[5 bonus points]">Part 4: Prolog  [5 bonus points]</a></li>
<li><a href="#Testing">Testing</a>
<ul>
<li><a href="#Automated-testing-via-Docker">Automated testing via Docker</a></li>
<li><a href="#The-tests">The tests</a></li>
<li><a href="#The-Docker-setup">The Docker setup</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-Introduction" class="outline-2">
<h2 id="Introduction">Introduction</h2>
<div class="outline-text-2" id="text-Introduction">
<p>
This homework presents a somewhat contrived problem
involving a computation over a slightly large dataset
in order to justify the use of concurrency.
</p>

<p>
This problem is based on the one presented on
<a href="https://adventofcode.com/2020/day/1">day 1</a> of
the <a href="https://adventofcode.com/">Advent of Code</a> programming challenge
for 2020.
</p>

<p>
The homework provides a solution to the problem in Clojure, Ruby
and Scala, and asks you to modify the solutions
to take advantage of concurency.
</p>
</div>
</div>

<div id="outline-container-Boilerplate" class="outline-2">
<h2 id="Boilerplate">Boilerplate</h2>
<div class="outline-text-2" id="text-Boilerplate">
</div>

<div id="outline-container-Submission-procedures" class="outline-3">
<h3 id="Submission-procedures">Submission procedures</h3>
<div class="outline-text-3" id="text-Submission-procedures">
</div>

<div id="outline-container-org770b696" class="outline-4">
<h4 id="org770b696">Submission method</h4>
<div class="outline-text-4" id="text-org770b696">
<p>
Homework should be submitted to your McMaster CAS Gitlab respository
in the <code>cs3mi3-fall2020</code> project.
</p>

<p>
Ensure that you have <b>pushed</b> the commits to the remote repository
in time for the deadline, and not just committed to your local copy.
</p>
</div>
</div>

<div id="outline-container-org6e0a4aa" class="outline-4">
<h4 id="org6e0a4aa">Naming requirements</h4>
<div class="outline-text-4" id="text-org6e0a4aa">
<p>
Place all files for the homework
inside a folder titled <code>hn</code>, where <code>n</code> is the number of the homework.
So, for homework 1, use the folder <code>h1</code>, for homework 2 the folder <code>h2</code>, etc.
Ensure you do not capitalise the <code>h</code>.
</p>

<p>
Unless otherwise instructed in the homework questions,
place all of your code for the homework
in a single file in the <code>hn</code> folder named <code>hn.ext</code>,
where <code>ext</code> is the appropriate extension for the language used
according to this list:
</p>
<ul class="org-ul">
<li>For Scala, <code>ext</code> is <code>sc</code>.</li>
<li>For Prolog, <code>ext</code> is <code>pl</code>.</li>
<li>For Ruby, <code>ext</code> is <code>rb</code>.</li>
<li>For Clojure, <code>ext</code> is <code>clj</code>.</li>
</ul>
<p>
If multiple languages are used in the homework,
submit a <code>hn.ext</code> file for each language.
</p>

<div class="org-center">
<p>
<b>If the language supports multiple different file extensions,</b>
<b>you must still follow the extension conventions above.</b>
</p>
</div>

<div class="org-center">
<p>
<b>Incorrect naming of files may result in up to a 10% deduction in your grade.</b>
</p>
</div>
</div>
</div>

<div id="outline-container-org09bfc1f" class="outline-4">
<h4 id="org09bfc1f">Do not submit testing or diagnostic code</h4>
<div class="outline-text-4" id="text-org09bfc1f">
<p>
Unless you are instructed to do so in the homework questions,
<b>you should not submit testing code with your homework submission</b>.
</p>

<p>
This includes
</p>
<ul class="org-ul">
<li>any <code>main</code> function,</li>
<li>any <code>print</code> statements which output information
<b>that is not directly requested as console output</b>
<b>in the homework questions</b>.</li>
</ul>

<p>
If you do not wish to remove diagnostic print statements manually,
you will have to find a way to ensure that they disabled
in your final submission.
</p>

<p>
For instance, by using a wrapper on the print function or macros.
</p>
</div>
</div>

<div id="outline-container-org6b1cca9" class="outline-4">
<h4 id="org6b1cca9">Due date and allowance for technical difficulties</h4>
<div class="outline-text-4" id="text-org6b1cca9">
<p>
Homework is due on the second Sunday following its release,
by the end of the day (midnight).
Submissions past 00:00 may not be considered.
</p>

<p>
If you experience technical difficulties
leading up to the submission time,
please contact Mark <b>ASAP</b> with the details of the problem
and, if possible, attach the current state of your homework
to the communication.
This information will help ensure we are able
to accept your submission once the technical difficulties are resolved.
</p>
</div>
</div>
</div>

<div id="outline-container-Proper-conduct-for-coursework" class="outline-3">
<h3 id="Proper-conduct-for-coursework">Proper conduct for coursework</h3>
<div class="outline-text-3" id="text-Proper-conduct-for-coursework">
</div>

<div id="outline-container-org152bfaa" class="outline-4">
<h4 id="org152bfaa">Individual work</h4>
<div class="outline-text-4" id="text-org152bfaa">
<p>
Unless explicitely stated in the homework questions,
all homework in this course is intended
to be <i>individually completed</i>.
</p>

<p>
You are welcome to discuss the content of the homework in
the public forum of the class Microsoft Teams team homework channel,
though obviously solutions or partial solutions should not
be posted or described.
</p>

<p>
Private discussions about the homework cannot reasonably be
forbidden, but such discussions should follow the same guidelines
as public discussions.
</p>

<div class="org-center">
<p>
<b>Inappopriate collaboration via private discussions</b>
<b>which is later discovered by course staff</b>
<b>may be considered academic dishonesty.</b>
</p>

<p>
When in doubt, make the discussion private, or report its contents
to the course staff by making a note of it
in your homework.
</p>
</div>

<p>
To clarify what is considered appropriate discussions
of homework content, here are some examples:
</p>
<ol class="org-ol">
<li>Discussing the language features introduced or needed for the homework.
<ul class="org-ul">
<li>Such as relevant builtin datatypes
and datatype definition methods and their general use.</li>
<li>Code snippets that are not partial solutions to the homework
are welcome and encouraged.</li>
</ul></li>
<li>Questions of the form “What is meant by <code>x</code>?”,
“Does <code>x</code> really mean <code>y</code>?” or “Is there a mistake with <code>x</code>?”
<ul class="org-ul">
<li>Of course, questions of those form which would be answered
by partial solutions are not considered appropriate.</li>
</ul></li>
<li>Questions or advice about errors that may be encountered.
<ul class="org-ul">
<li>Such as “If you see a <code>scala.MatchError</code> you should
probably add a catch-all <code>_</code> case to your <code>match</code> expressions.”</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-org300fbde" class="outline-4">
<h4 id="org300fbde">Language library resources</h4>
<div class="outline-text-4" id="text-org300fbde">
<p>
Unless explicitely stated in the questions,
it is not expected that you will use any language library resources
in the homeworks.
</p>

<p>
Possible exceptions to this rule include implementations
of datatypes we discuss in this course, such as lists
or options/maybes, if they are included in a standard library
instead of being builtin.
</p>

<p>
<i>Basic</i> operations on such types would also be allowed.
</p>
<ul class="org-ul">
<li>For instance, <code>head</code>, <code>tail</code>, <code>append</code>, etc. on lists
would not require explicit permission to be used.</li>
<li>More complex operations such as sorting procedures
would require permission before you used them.</li>
</ul>

<p>
Additionally, the standard <i>higher-order</i> operations
including <code>map</code>, <code>reduce</code>, <code>flatten</code>, and <code>filter</code> are permitted generally,
unless the task is to implement such a higher-order operator.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-Part-0:-The-problem" class="outline-2">
<h2 id="Part-0:-The-problem">Part 0: The problem</h2>
<div class="outline-text-2" id="text-Part-0:-The-problem">
<p>
You are provided with a collection of integers for this homework.
What we want to compute on this collection is:
Given an integer <code>sum</code>, find all possible pairs
of (two of) those integers whose sum is less than or equal to <code>sum</code>,
and return a sequence of those pairs.
</p>

<p>
(The pairing of one of the integers with itself is
assumed not to count, unless that integer
appears twice in the provided collection.)
</p>

<p>
Code is provided which solves this problem in Clojure,
Ruby and Scala. Your task is then to improve the performance
of this code using concurrency.
</p>

<p>
Note that we will not test for the exact ordering of the sequence,
and it is not required to be in a specific order.
We will instead test for membership within the list.
</p>

<p>
The collection is available <a href="./src/h10/collection.txt">here</a> in plaintext,
and below as a defined sequence in each language.
</p>
</div>
</div>

<div id="outline-container-Part-1:-Clojure-[15 points]" class="outline-2">
<h2 id="Part-1:-Clojure-[15 points]">Part 1: Clojure [15 points]</h2>
<div class="outline-text-2" id="text-Part-1:-Clojure-[15 points]">
<p>
The given collection is available in the file <a href="./src/h10/collection.clj">collection.clj</a>,
which defines it as a Clojure array <code>input</code>.
</p>

<p>
Below, you will see the function <code>summingPairs</code> implemented in Clojure
to solve our given problem.
</p>

<p>
Implement a version of <code>summingPairs</code> which takes advantage of
the <code>future</code> form to run parts of the computation in separate threads.
You may choose how many threads to make use of.
Try to improve the performance of <code>summingPairs</code> through this process.
</p>

<p>
Here is the function:
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #00cd68;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">summingPairs</span> <span style="color: #b6a0ff;">[</span>xs sum<span style="color: #b6a0ff;">]</span>
  <span style="color: #b6a0ff;">(</span><span style="color: #b6a0ff;">letfn</span> <span style="color: #6ae4b9;">[</span><span style="color: #f0ce43;">(</span>summingPairsHelper <span style="color: #00bcff;">[</span>xs the_pairs<span style="color: #00bcff;">]</span>
            <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">If `</span><span style="color: #00bcff;">xs</span><span style="color: #a8a8a8;">` is empty, we're done.</span>
            <span style="color: #00bcff;">(</span><span style="color: #b6a0ff;">if</span> <span style="color: #80d200;">(</span>empty? xs<span style="color: #80d200;">)</span> the_pairs
                <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">Otherwise, decompose `</span><span style="color: #00bcff;">xs</span><span style="color: #a8a8a8;">` into the `</span><span style="color: #00bcff;">fst</span><span style="color: #a8a8a8;">` element</span>
                <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">and the `</span><span style="color: #00bcff;">rest</span><span style="color: #a8a8a8;">`.</span>
                <span style="color: #80d200;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #f78fe7;">[</span><span style="color: #4ae8fc;">[</span>fst &amp; rest<span style="color: #4ae8fc;">]</span> xs<span style="color: #f78fe7;">]</span>
                  <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">We use the `</span><span style="color: #00bcff;">recur</span><span style="color: #a8a8a8;">` form to make the recursive call.</span>
                  <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">This ensures tail call optimisation</span>
                  <span style="color: #f78fe7;">(</span><span style="color: #b6a0ff;">recur</span>
                   rest
                   <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">Concatenate `</span><span style="color: #00bcff;">the_pairs</span><span style="color: #a8a8a8;">` we have so far with the sequence</span>
                   <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">of every `[fst snd]` where `</span><span style="color: #00bcff;">snd</span><span style="color: #a8a8a8;">` is in `</span><span style="color: #00bcff;">rest</span><span style="color: #a8a8a8;">` with</span>
                   <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">`fst + snd &lt;= sum`. The `</span><span style="color: #00bcff;">doall</span><span style="color: #a8a8a8;">` outside the `</span><span style="color: #00bcff;">concat</span><span style="color: #a8a8a8;">`</span>
                   <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">forces it to be calculated immediately; without this,</span>
                   <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">we get a (lazy) buildup of `</span><span style="color: #00bcff;">concat</span><span style="color: #a8a8a8;">`'s which may</span>
                   <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">cause a stack overflow when looking at the result.</span>
                   <span style="color: #4ae8fc;">(</span><span style="color: #b6a0ff;">doall</span> 
                    <span style="color: #cfdf30;">(</span>concat the_pairs
                            <span style="color: #00cd68;">(</span><span style="color: #b6a0ff;">for</span> <span style="color: #b6a0ff;">[</span>snd rest <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">For each `</span><span style="color: #00bcff;">snd</span><span style="color: #a8a8a8;">` in `</span><span style="color: #00bcff;">rest</span><span style="color: #a8a8a8;">`...</span>
                                  <span style="color: #00bcff;">:when</span> <span style="color: #6ae4b9;">(</span>&lt;= <span style="color: #f0ce43;">(</span>+ fst snd<span style="color: #f0ce43;">)</span> sum<span style="color: #6ae4b9;">)</span><span style="color: #b6a0ff;">]</span>
                              <span style="color: #a8a8a8;">;;</span><span style="color: #a8a8a8;">... put `[fst snd]` into this sequence.</span>
                              <span style="color: #b6a0ff;">[</span>fst snd<span style="color: #b6a0ff;">]</span><span style="color: #00cd68;">)</span><span style="color: #cfdf30;">)</span><span style="color: #4ae8fc;">)</span><span style="color: #f78fe7;">)</span><span style="color: #80d200;">)</span><span style="color: #00bcff;">)</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">]</span>
    <span style="color: #6ae4b9;">(</span>summingPairsHelper xs <span style="color: #f0ce43;">[]</span><span style="color: #6ae4b9;">)</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
</pre>
</div>

<p>
It can be run over the <code>input</code> using the following code,
which also shows the starting and ending time of the computation,
so you may judge its performance.
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #00cd68;">(</span>load-file <span style="color: #79a8ff;">"./collection.clj"</span><span style="color: #00cd68;">)</span>

<span style="color: #00cd68;">(</span>println <span style="color: #b6a0ff;">(</span>str
          <span style="color: #79a8ff;">"Starting at:   "</span>
          <span style="color: #6ae4b9;">(</span>.getSecond <span style="color: #f0ce43;">(</span><span style="color: #6ae4b9;">java.time.LocalDateTime</span>/now<span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>
          <span style="color: #79a8ff;">" seconds, "</span>
          <span style="color: #6ae4b9;">(</span>.getNano <span style="color: #f0ce43;">(</span><span style="color: #6ae4b9;">java.time.LocalDateTime</span>/now<span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>
          <span style="color: #79a8ff;">" nanoseconds"</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
<span style="color: #00cd68;">(</span>println <span style="color: #b6a0ff;">(</span>summingPairs input 2020<span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
<span style="color: #00cd68;">(</span>println <span style="color: #b6a0ff;">(</span>str
          <span style="color: #79a8ff;">"Ending at:     "</span>
          <span style="color: #6ae4b9;">(</span>.getSecond <span style="color: #f0ce43;">(</span><span style="color: #6ae4b9;">java.time.LocalDateTime</span>/now<span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>
          <span style="color: #79a8ff;">" seconds, "</span>
          <span style="color: #6ae4b9;">(</span>.getNano <span style="color: #f0ce43;">(</span><span style="color: #6ae4b9;">java.time.LocalDateTime</span>/now<span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>
          <span style="color: #79a8ff;">" nanoseconds"</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-Part-2:-Ruby----[15 points]" class="outline-2">
<h2 id="Part-2:-Ruby----[15 points]">Part 2: Ruby    [15 points]</h2>
<div class="outline-text-2" id="text-Part-2:-Ruby----[15 points]">
<p>
Repeat part 1 in Ruby, potentially using the below method <code>summingPairs</code> as
a starting point.
</p>

<p>
The <code>input</code> collection is defined as a Ruby array
in the file <a href="./src/h10/collection.rb">collection.rb</a>.
</p>

<p>
The method:
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #6ae4b9;">Pair</span> = <span style="color: #6ae4b9;">Struct</span>.new<span style="color: #00cd68;">(</span><span style="color: #00bcff;">:fst</span>,<span style="color: #00bcff;">:snd</span><span style="color: #00cd68;">)</span>

<span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">summingPairs</span><span style="color: #00cd68;">(</span>xs, sum<span style="color: #00cd68;">)</span>
  the_pairs = <span style="color: #00cd68;">[]</span>
  len = xs.length

  <span style="color: #b6a0ff;">for</span> i <span style="color: #b6a0ff;">in</span> 0..<span style="color: #00cd68;">(</span>len-1<span style="color: #00cd68;">)</span>
    <span style="color: #b6a0ff;">for</span> j <span style="color: #b6a0ff;">in</span> <span style="color: #00cd68;">(</span>i+1<span style="color: #00cd68;">)</span>..<span style="color: #00cd68;">(</span>len-1<span style="color: #00cd68;">)</span>
      <span style="color: #b6a0ff;">if</span> xs<span style="color: #00cd68;">[</span>i<span style="color: #00cd68;">]</span> + xs<span style="color: #00cd68;">[</span>j<span style="color: #00cd68;">]</span> &lt;= sum
        the_pairs.push<span style="color: #00cd68;">(</span><span style="color: #6ae4b9;">Pair</span>.new<span style="color: #b6a0ff;">(</span>xs<span style="color: #6ae4b9;">[</span>i<span style="color: #6ae4b9;">]</span>,xs<span style="color: #6ae4b9;">[</span>j<span style="color: #6ae4b9;">]</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
      <span style="color: #b6a0ff;">end</span>
    <span style="color: #b6a0ff;">end</span>
  <span style="color: #b6a0ff;">end</span>

  <span style="color: #b6a0ff;">return</span> the_pairs
<span style="color: #b6a0ff;">end</span>
</pre>
</div>

<p>
And code to make use of it on the <code>input</code> array:
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #f78fe7;">require</span> <span style="color: #79a8ff;">'date'</span>
<span style="color: #f78fe7;">require_relative</span> <span style="color: #79a8ff;">'collection'</span>

<span style="color: #f78fe7;">puts</span> <span style="color: #79a8ff;">"Starting at:   </span><span style="color: #00d3d0;">#{DateTime.now.sec}</span><span style="color: #79a8ff;"> seconds, </span><span style="color: #00d3d0;">#{DateTime.now.strftime("%9N")}</span><span style="color: #79a8ff;"> nanoseconds"</span>
<span style="color: #f78fe7;">puts</span> summingPairs<span style="color: #00cd68;">(</span><span style="color: #6ae4b9;">INPUT</span>,2020<span style="color: #00cd68;">)</span>
<span style="color: #f78fe7;">puts</span> <span style="color: #79a8ff;">"Ending at:     </span><span style="color: #00d3d0;">#{DateTime.now.sec}</span><span style="color: #79a8ff;"> seconds, </span><span style="color: #00d3d0;">#{DateTime.now.strftime("%9N")}</span><span style="color: #79a8ff;"> nanoseconds"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-Part-3:-Scala---[15 points]" class="outline-2">
<h2 id="Part-3:-Scala---[15 points]">Part 3: Scala   [15 points]</h2>
<div class="outline-text-2" id="text-Part-3:-Scala---[15 points]">
<p>
Once more, repeat parts 1 and 2, this time in Scala.
You may make use of the below method <code>summingPairs</code> if you like.
</p>

<p>
This time, the <code>input</code> collection is defined as a Scala array
in <a href="./src/h10/collection.sc">collection.sc</a>. Note this is an array, not a list as we have
usually made use of in Scala.
The size of the collection necessitated avoiding the (linked) list type.
</p>

<p>
The method:
</p>
<div class="org-src-container">
<pre class="src src-amm"><span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">summingPairs</span><span style="color: #00cd68;">(</span>xs<span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">Vector</span><span style="color: #b6a0ff;">[</span><span style="color: #00bcff;">Int</span><span style="color: #b6a0ff;">]</span>, sum<span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">Int</span><span style="color: #00cd68;">)</span><span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">Vector</span><span style="color: #00cd68;">[</span><span style="color: #00bcff;">Tuple2</span><span style="color: #b6a0ff;">[</span><span style="color: #00bcff;">Int</span>,<span style="color: #00bcff;">Int</span><span style="color: #b6a0ff;">]</span><span style="color: #00cd68;">]</span> <span style="color: #b6a0ff;">=</span> <span style="color: #00cd68;">{</span>
  <span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">summingPairsHelper</span><span style="color: #b6a0ff;">(</span>xs<span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">Vector</span><span style="color: #6ae4b9;">[</span><span style="color: #00bcff;">Int</span><span style="color: #6ae4b9;">]</span>,
                         the_pairs<span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">Vector</span><span style="color: #6ae4b9;">[</span><span style="color: #00bcff;">Tuple2</span><span style="color: #f0ce43;">[</span><span style="color: #00bcff;">Int</span>,<span style="color: #00bcff;">Int</span><span style="color: #f0ce43;">]</span><span style="color: #6ae4b9;">]</span><span style="color: #b6a0ff;">)</span><span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">Vector</span><span style="color: #b6a0ff;">[</span><span style="color: #00bcff;">Tuple2</span><span style="color: #6ae4b9;">[</span><span style="color: #00bcff;">Int</span>,<span style="color: #00bcff;">Int</span><span style="color: #6ae4b9;">]</span><span style="color: #b6a0ff;">]</span> <span style="color: #b6a0ff;">=</span>
    xs <span style="color: #b6a0ff;">match</span> <span style="color: #b6a0ff;">{</span>
      <span style="color: #b6a0ff;">case</span> <span style="color: #00d3d0;">fst</span> <span style="color: #6ae4b9;">+:</span> <span style="color: #00d3d0;">rest</span> <span style="color: #b6a0ff;">=&gt;</span>
        <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">Search through `rest` for numbers `snd` such that `fst + snd` is the `sum`.</span>
        <span style="color: #b6a0ff;">val</span> <span style="color: #00d3d0;">pairs_here</span> <span style="color: #b6a0ff;">=</span> rest.collect<span style="color: #6ae4b9;">(</span><span style="color: #f0ce43;">{</span><span style="color: #b6a0ff;">case</span> <span style="color: #00d3d0;">snd</span> <span style="color: #b6a0ff;">if</span> fst + snd &lt;= sum <span style="color: #b6a0ff;">=&gt;</span> <span style="color: #00bcff;">(</span>fst,snd<span style="color: #00bcff;">)</span><span style="color: #f0ce43;">}</span><span style="color: #6ae4b9;">)</span>
        <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">Make the recursive call, adding in the pairs we just found.</span>
        summingPairsHelper<span style="color: #6ae4b9;">(</span>rest, the_pairs ++ pairs_here<span style="color: #6ae4b9;">)</span>
      <span style="color: #b6a0ff;">case</span> <span style="color: #b6a0ff;">_</span> <span style="color: #b6a0ff;">=&gt;</span> the_pairs <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">If there's no head element, the vector is empty.</span>
    <span style="color: #b6a0ff;">}</span>
  
  summingPairsHelper<span style="color: #b6a0ff;">(</span>xs,<span style="color: #00bcff;">Vector</span><span style="color: #6ae4b9;">()</span><span style="color: #b6a0ff;">)</span>
<span style="color: #00cd68;">}</span>
</pre>
</div>

<p>
And code to make use of it on the <code>input</code> array:
</p>
<div class="org-src-container">
<pre class="src src-amm"><span style="color: #b6a0ff;">import</span> java.time.<span style="color: #00bcff;">LocalDateTime</span>
<span style="color: #b6a0ff;">import</span> $file.collection, collection.<span style="color: #b6a0ff;">_</span>

println<span style="color: #00cd68;">(</span>s<span style="color: #79a8ff;">"Starting at:   </span><span style="color: #00d3d0;">${LocalDateTime.now.getSecond}</span><span style="color: #79a8ff;"> seconds, </span><span style="color: #00d3d0;">${LocalDateTime.now.getNano}</span><span style="color: #79a8ff;"> nanoseconds"</span><span style="color: #00cd68;">)</span>
println<span style="color: #00cd68;">(</span>summingPairs<span style="color: #b6a0ff;">(</span>input,<span style="color: #00bcff;">2020</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
println<span style="color: #00cd68;">(</span>s<span style="color: #79a8ff;">"Ending at:     </span><span style="color: #00d3d0;">${LocalDateTime.now.getSecond}</span><span style="color: #79a8ff;"> seconds, </span><span style="color: #00d3d0;">${LocalDateTime.now.getNano}</span><span style="color: #79a8ff;"> nanoseconds"</span><span style="color: #00cd68;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-Part-4:-Prolog--[5 bonus points]" class="outline-2">
<h2 id="Part-4:-Prolog--[5 bonus points]">Part 4: Prolog  [5 bonus points]</h2>
<div class="outline-text-2" id="text-Part-4:-Prolog--[5 bonus points]">
<p>
For bonus marks, implement a <code>summingPairs</code> predicate in Prolog,
making use of the <code>concurrent</code> predicate.
</p>
</div>
</div>

<div id="outline-container-Testing" class="outline-2">
<h2 id="Testing">Testing</h2>
<div class="outline-text-2" id="text-Testing">
<p>
Unit tests for the requested methods/functions
are available:
</p>
<ul class="org-ul">
<li><a href="./testing/h10/h10t.clj">h10t.clj</a> for Clojure,</li>
<li><a href="./testing/h10/h10t.rb">h10t.rb</a> for Ruby, and</li>
<li><a href="./testing/h10/h10t.sc">h10t.sc</a> for Scala.</li>
</ul>
<p>
The contents of the unit test file are also repeated below.
</p>
</div>

<div id="outline-container-Automated-testing-via-Docker" class="outline-3">
<h3 id="Automated-testing-via-Docker">Automated testing via Docker</h3>
<div class="outline-text-3" id="text-Automated-testing-via-Docker">
<p>
The Docker setup and usage scripts are available at the following links.
Their contents are also repeated below.
</p>
<ul class="org-ul">
<li><a href="./testing/h10/Dockerfile">Dockerfile</a></li>
<li><a href="./testing/h10/docker-compose.yml">docker-compose.yml</a></li>
<li><a href="./testing/h10/setup.sh">setup.sh</a></li>
<li><a href="./testing/h10/run.sh">run.sh</a></li>
</ul>
<p>
Place them into your <code>h10</code> directory where your <code>h10.clj</code> file
and the <code>h10t.clj</code> (linked to above) files exist,
then run <code>setup.sh</code> and <code>run.sh</code>.
</p>

<p>
You may also refer to the README
for this testing setup and those files
<a href="https://github.com/armkeh/principles-of-programming-languages/tree/master/homework/testing/h10">on the course GitHub repo</a>.
</p>

<p>
Note that the use of the <code>setup.sh</code> and <code>run.sh</code> scripts assumes
that you are in a <code>bash</code> like shell; if you are on Windows,
and not using WSL or WSL2, you may have
to run the commands contained in those scripts manually.
</p>
</div>
</div>

<div id="outline-container-The-tests" class="outline-3">
<h3 id="The-tests">The tests</h3>
<div class="outline-text-3" id="text-The-tests">
<p>
The contents of the testing scripts are repeated here.
</p>

<p>
<a href="./testing/h10/h10t.clj">h10t.clj</a>
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #00cd68;">(</span><span style="color: #b6a0ff;">ns</span> <span style="color: #6ae4b9;">testing</span><span style="color: #00cd68;">)</span>
<span style="color: #00cd68;">(</span>use 'clojure.test<span style="color: #00cd68;">)</span>
<span style="color: #00cd68;">(</span>load-file <span style="color: #79a8ff;">"collection.clj"</span><span style="color: #00cd68;">)</span> <span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">The `</span><span style="color: #00bcff;">collection</span><span style="color: #a8a8a8;">` file provided with the homework.</span>
<span style="color: #00cd68;">(</span>load-file <span style="color: #79a8ff;">"h10.clj"</span><span style="color: #00cd68;">)</span>

<span style="color: #00cd68;">(</span><span style="color: #b6a0ff;">deftest</span> <span style="color: #feacd0;">contains-checks</span>
  <span style="color: #b6a0ff;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #6ae4b9;">[</span>result <span style="color: #f0ce43;">(</span>summingPairs input 2020<span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">]</span>
    <span style="color: #6ae4b9;">(</span>is <span style="color: #f0ce43;">(</span>contains? <span style="color: #00bcff;">(</span>set result<span style="color: #00bcff;">)</span> <span style="color: #00bcff;">[</span>374 150<span style="color: #00bcff;">]</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>
    <span style="color: #6ae4b9;">(</span>is <span style="color: #f0ce43;">(</span>contains? <span style="color: #00bcff;">(</span>set result<span style="color: #00bcff;">)</span> <span style="color: #00bcff;">[</span>626 1030<span style="color: #00bcff;">]</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>
    <span style="color: #6ae4b9;">(</span>is <span style="color: #f0ce43;">(</span>contains? <span style="color: #00bcff;">(</span>set result<span style="color: #00bcff;">)</span> <span style="color: #00bcff;">[</span>150 1850<span style="color: #00bcff;">]</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>

<span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">If we define `</span><span style="color: #00bcff;">test-ns-hook</span><span style="color: #a8a8a8;">`, it is called when running `</span><span style="color: #00bcff;">run-tests</span><span style="color: #a8a8a8;">`,</span>
<span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">instead of just calling all tests in the namespace.</span>
<span style="color: #a8a8a8;">;; </span><span style="color: #a8a8a8;">This lets us control the order of the tests.</span>
<span style="color: #00cd68;">(</span><span style="color: #b6a0ff;">deftest</span> <span style="color: #feacd0;">test-ns-hook</span>
  <span style="color: #b6a0ff;">(</span>contains-checks<span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>

<span style="color: #00cd68;">(</span>run-tests 'testing<span style="color: #00cd68;">)</span>
</pre>
</div>

<p>
<a href="./testing/h10/h10t.rb">h10t.rb</a>
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #f78fe7;">require_relative</span> <span style="color: #79a8ff;">"h10"</span>
<span style="color: #f78fe7;">require</span> <span style="color: #79a8ff;">"test/unit"</span>

<span style="color: #6ae4b9;">RESULT</span> = summingPairs<span style="color: #00cd68;">(</span><span style="color: #6ae4b9;">INPUT</span>,2020<span style="color: #00cd68;">)</span>

<span style="color: #b6a0ff;">class</span> <span style="color: #6ae4b9;">SimpleTests</span> &lt; <span style="color: #6ae4b9;">Test</span>::<span style="color: #6ae4b9;">Unit</span>::<span style="color: #6ae4b9;">TestCase</span>
  <span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">test_contains_checks</span>
    assert_equal<span style="color: #00cd68;">(</span><span style="color: #00bcff;">true</span>, <span style="color: #6ae4b9;">RESULT</span>.include?<span style="color: #b6a0ff;">(</span><span style="color: #6ae4b9;">Pair</span>.new<span style="color: #6ae4b9;">(</span>374, 150<span style="color: #6ae4b9;">)</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
    assert_equal<span style="color: #00cd68;">(</span><span style="color: #00bcff;">true</span>, <span style="color: #6ae4b9;">RESULT</span>.include?<span style="color: #b6a0ff;">(</span><span style="color: #6ae4b9;">Pair</span>.new<span style="color: #6ae4b9;">(</span>626, 1030<span style="color: #6ae4b9;">)</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
    assert_equal<span style="color: #00cd68;">(</span><span style="color: #00bcff;">true</span>, <span style="color: #6ae4b9;">RESULT</span>.include?<span style="color: #b6a0ff;">(</span><span style="color: #6ae4b9;">Pair</span>.new<span style="color: #6ae4b9;">(</span>150, 1850<span style="color: #6ae4b9;">)</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>
  <span style="color: #b6a0ff;">end</span>
<span style="color: #b6a0ff;">end</span>
</pre>
</div>

<p>
<a href="./testing/h10/h10t.sc">h10t.sc</a>
</p>
<div class="org-src-container">
<pre class="src src-amm"><span style="color: #b6a0ff;">import</span> $file.h10, h10.<span style="color: #b6a0ff;">_</span>
<span style="color: #b6a0ff;">import</span> $file.collection, collection.<span style="color: #b6a0ff;">_</span>

<span style="color: #a8a8a8;">/* </span><span style="color: #a8a8a8;">Given an expected result and a computed result,</span>
<span style="color: #a8a8a8;">   check if they are equal in value.</span>
<span style="color: #a8a8a8;">   If so, return 0. Otherwise, inform the user, and return 1,</span>
<span style="color: #a8a8a8;">   so the number of failures can be counted. */</span>
<span style="color: #b6a0ff;">def</span> <span style="color: #feacd0;">test</span><span style="color: #00cd68;">[</span><span style="color: #00bcff;">A</span><span style="color: #00cd68;">](</span><span style="color: #b6a0ff;">given:</span> <span style="color: #6ae4b9;">A</span>, expected<span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">A</span>, the_test<span style="color: #b6a0ff;">:</span> <span style="color: #6ae4b9;">String</span><span style="color: #00cd68;">)</span> <span style="color: #b6a0ff;">=</span>
  <span style="color: #b6a0ff;">if</span> <span style="color: #00cd68;">(</span>!<span style="color: #b6a0ff;">(</span><span style="color: #b6a0ff;">given</span> equals expected<span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span> <span style="color: #00cd68;">{</span>
    println<span style="color: #b6a0ff;">(</span><span style="color: #79a8ff;">"+---------------------------------------------------"</span><span style="color: #b6a0ff;">)</span>
    println<span style="color: #b6a0ff;">(</span><span style="color: #79a8ff;">"| "</span> + the_test + <span style="color: #79a8ff;">" failed."</span><span style="color: #b6a0ff;">)</span>
    println<span style="color: #b6a0ff;">(</span><span style="color: #79a8ff;">"| Expected "</span> + expected + <span style="color: #79a8ff;">", got "</span> + <span style="color: #b6a0ff;">given</span> + <span style="color: #79a8ff;">"."</span><span style="color: #b6a0ff;">)</span>
    println<span style="color: #b6a0ff;">(</span><span style="color: #79a8ff;">"+---------------------------------------------------"</span><span style="color: #b6a0ff;">)</span>
    <span style="color: #00bcff;">1</span>
  <span style="color: #00cd68;">}</span> <span style="color: #b6a0ff;">else</span> <span style="color: #00cd68;">{</span>
    <span style="color: #00bcff;">0</span>
  <span style="color: #00cd68;">}</span>


<span style="color: #b6a0ff;">val</span> <span style="color: #00d3d0;">result</span> <span style="color: #b6a0ff;">=</span> summingPairs<span style="color: #00cd68;">(</span>input,<span style="color: #00bcff;">2020</span><span style="color: #00cd68;">)</span>

<span style="color: #a8a8a8;">//  </span><span style="color: #a8a8a8;">The tests are saved as tuples, the pieces of which will be passed</span>
<span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">to test.</span>
<span style="color: #b6a0ff;">val</span> <span style="color: #00d3d0;">tests</span> <span style="color: #b6a0ff;">=</span> <span style="color: #00bcff;">List</span><span style="color: #00cd68;">(</span>
  <span style="color: #b6a0ff;">(</span>result.contains<span style="color: #6ae4b9;">(</span><span style="color: #00bcff;">Tuple2</span><span style="color: #f0ce43;">(</span><span style="color: #00bcff;">374</span>,<span style="color: #00bcff;">150</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>, <span style="color: #00bcff;">true</span>, <span style="color: #79a8ff;">"374,150"</span><span style="color: #b6a0ff;">)</span>,
  <span style="color: #b6a0ff;">(</span>result.contains<span style="color: #6ae4b9;">(</span><span style="color: #00bcff;">Tuple2</span><span style="color: #f0ce43;">(</span><span style="color: #00bcff;">626</span>,<span style="color: #00bcff;">1030</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>, <span style="color: #00bcff;">true</span>, <span style="color: #79a8ff;">"626,1030"</span><span style="color: #b6a0ff;">)</span>,
  <span style="color: #b6a0ff;">(</span>result.contains<span style="color: #6ae4b9;">(</span><span style="color: #00bcff;">Tuple2</span><span style="color: #f0ce43;">(</span><span style="color: #00bcff;">150</span>,<span style="color: #00bcff;">1850</span><span style="color: #f0ce43;">)</span><span style="color: #6ae4b9;">)</span>, <span style="color: #00bcff;">true</span>, <span style="color: #79a8ff;">"150,1850"</span><span style="color: #b6a0ff;">)</span><span style="color: #00cd68;">)</span>

<span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">Apply test to each element of tests, and sum the return values.</span>
<span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">This is essentially a for loop.</span>
<span style="color: #b6a0ff;">val</span> <span style="color: #00d3d0;">failed</span> <span style="color: #b6a0ff;">=</span> tests.foldLeft<span style="color: #00cd68;">(</span><span style="color: #00bcff;">0</span><span style="color: #00cd68;">)</span> <span style="color: #00cd68;">{</span>
  <span style="color: #b6a0ff;">(</span>failures, next<span style="color: #b6a0ff;">)</span> <span style="color: #b6a0ff;">=&gt;</span> next <span style="color: #b6a0ff;">match</span> <span style="color: #b6a0ff;">{</span>
    <span style="color: #a8a8a8;">// </span><span style="color: #a8a8a8;">Deconstruct the tuple to get its parts</span>
    <span style="color: #b6a0ff;">case</span> <span style="color: #6ae4b9;">(</span><span style="color: #b6a0ff;">given</span>, expected, the_test<span style="color: #6ae4b9;">)</span> <span style="color: #b6a0ff;">=&gt;</span> failures + test<span style="color: #6ae4b9;">(</span><span style="color: #b6a0ff;">given</span>, expected, the_test<span style="color: #6ae4b9;">)</span>
  <span style="color: #b6a0ff;">}</span>
<span style="color: #00cd68;">}</span>

println<span style="color: #00cd68;">(</span><span style="color: #79a8ff;">"+---------------------------------------------------"</span><span style="color: #00cd68;">)</span>
println<span style="color: #00cd68;">(</span><span style="color: #79a8ff;">"| "</span> + failed + <span style="color: #79a8ff;">" tests failed"</span><span style="color: #00cd68;">)</span>
println<span style="color: #00cd68;">(</span><span style="color: #79a8ff;">"+---------------------------------------------------"</span><span style="color: #00cd68;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-The-Docker-setup" class="outline-3">
<h3 id="The-Docker-setup">The Docker setup</h3>
<div class="outline-text-3" id="text-The-Docker-setup">
<p>
The contents of the Docker setup files and scripts are repeated here.
</p>

<p>
<a href="./testing/h10/Dockerfile">Dockerfile</a>
</p>
<div class="org-src-container">
<pre class="src src-docker"># Define the argument for openjdk version
ARG OPENJDK_TAG=8u232

FROM clojure:openjdk-8

# Setup to install Scala
RUN apt-get update &amp;&amp; \
    apt-get install scala -y &amp;&amp; \
    apt-get install -y curl &amp;&amp; \
    sh -c '(echo "#!/usr/bin/env sh" &amp;&amp; \
    curl -L https://github.com/lihaoyi/Ammonite/releases/download/2.1.1/2.12-2.1.1) &gt; /usr/local/bin/amm &amp;&amp; \
    chmod +x /usr/local/bin/amm'
RUN (rm -rf /root/.cache)

# Install Ruby
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends --no-install-suggests curl bzip2 build-essential libssl-dev libreadline-dev zlib1g-dev &amp;&amp; \
    rm -rf /var/lib/apt/lists/* &amp;&amp; \
    curl -L https://github.com/rbenv/ruby-build/archive/v20201118.tar.gz | tar -zxvf - -C /tmp/ &amp;&amp; \
    cd /tmp/ruby-build-* &amp;&amp; ./install.sh &amp;&amp; cd / &amp;&amp; \
    ruby-build -v 2.7.2 /usr/local &amp;&amp; rm -rfv /tmp/ruby-build-*

# Set the name of the maintainers
MAINTAINER Habib Ghaffari Hadigheh, Mark Armstrong &lt;ghaffh1@mcmaster.ca, armstmp@mcmaster.ca&gt;

# Set the working directory
WORKDIR /opt/h10
</pre>
</div>

<p>
<a href="./testing/h10/docker-compose.yml">docker-compose.yml</a>
</p>
<div class="org-src-container">
<pre class="src src-yaml">version: '2'
services:
  service:
    build: .
    image: 3mi3_h10_docker_image
    volumes:
      - .:/opt/h10
    container_name: 3mi3_h10_container
    command: bash -c
      "echo 'Scala testing' ;
       echo '----------------------------------------------------------------------' ;
       amm h10t.sc ;
       printf '\\n\\n\\n' ;
       echo 'Ruby testing' ;
       echo '----------------------------------------------------------------------' ;
       ruby h10t.rb ;
       echo '----------------------------------------------------------------------' ;
       printf '\\n\\n\\n' ;
       echo 'Clojure testing' ;
       echo '----------------------------------------------------------------------' ;
       cat h10t.clj | lein repl ;
       echo '----------------------------------------------------------------------'"
</pre>
</div>

<p>
<a href="./testing/h10/setup.sh">setup.sh</a>
</p>
<div class="org-src-container">
<pre class="src src-shell">docker-compose build --force-rm
</pre>
</div>

<p>
<a href="./testing/h10/run.sh">run.sh</a>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a8a8a8;"># </span><span style="color: #a8a8a8;">Run the container</span>
docker-compose up --force-recreate
<span style="color: #a8a8a8;"># </span><span style="color: #a8a8a8;">Stop the container after finishing the test run</span>
docker-compose stop -t 1
</pre>
</div>

<p>
<a href="./testing/h10/README.md">README.md</a>
</p>
<div class="org-src-container">
<pre class="src src-text"># Instructions for automated testing using Docker

We have already created a `Dockerfile` here which specifies
all the necessary packages, etc., for compiling and running your code.
You only need to follow the instructions below to see 
the results of unit tests designed to check your implementation.

## Setup
We use `docker-compose` and its configuration file to build the image.
Assuming you have `docker` and `docker-compose` installed,
simply execute
```shell script
./setup.sh
```
to generate the image.

## Prepare your code for the running the tests
You only need to place the `h8t.clj` unit test file and
the `run.sh` file in the same directory as your `h9.clj` source file.

## Running the tests
As with the build process, we have already put
the configuration needed for running the test inside `docker-compose.yml`.
Simply execute
```shell script
./run.sh
```
to run and see the results of the tests.
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Mark Armstrong</p>
     <p class="author">Contact: <a href="mailto:markparmstrong@gmail.com">markparmstrong@gmail.com</a></p>
     <p class="date">Original date: December 4, 2020</p>
     <p class="date">Last updated: 2020-12-07 Mon 19:10</p>
     <p class="creator">Created using <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.0.91 (<a href="https://orgmode.org">Org</a> mode 9.4)</p>
     <p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
